<!DOCTYPE html>
<html lang="nl">
  <head>
    <title>WebAR Kunstinstallatie</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/aframe@1.5.0/dist/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.3/dist/mindar-image-aframe.prod.js"></script>
    <style>
      body { margin:0; overflow:hidden; background:#222; font-family:'Source Code Pro',monospace;}
      #overlay, #fallback, #loader, #ankerherkend {
        position:fixed;top:0;left:0;width:100vw;height:100vh;
        display:flex;align-items:center;justify-content:center;
        background:rgba(34,34,34,0.85);color:#fff;z-index:10;
        font-size:1.3em;text-align:center;padding:2em;
        transition:opacity 0.5s;box-sizing:border-box;overflow:auto;
        max-width:100vw;max-height:100vh;pointer-events:none;
      }
      #overlay.hide, #fallback.hide, #loader.hide, #ankerherkend.hide {opacity:0;}
      #fallback {background:rgba(34,34,34,0.97);z-index:14;}
      #loader {background:rgba(34,34,34,0.92);z-index:20;font-size:1.4em;}
      #ankerherkend {background:rgba(50,180,70,0.95);color:#fff;z-index:30;font-size:2em;}
      #lang-switch, #uitleg-btn, #insta-btn {
        position:fixed;top:18px;background:#fff;color:#111;
        border:none;border-radius:20px;padding:7px 18px;font-size:1em;font-weight:bold;
        box-shadow:0 2px 8px #0003;cursor:pointer;z-index:100;
        font-family:'Source Code Pro',monospace !important;
      }
      #lang-switch { right:18px; }
      #uitleg-btn { left:18px;font-weight:400;background:#f6f6f6;color:#1a1a1a;}
      #insta-btn { top:auto;bottom:24px;right:16px;padding:8px 18px;border-radius:20px;background:#fff;
        color:#111;font-weight:600;text-decoration:none;box-shadow:0 2px 12px #0003;font-size:1em;}
      #uitleg-overlay {position:fixed;left:0;top:0;width:100vw;height:100vh;background:rgba(30,30,30,0.94);
        color:#fff;z-index:50;display:flex;align-items:center;justify-content:center;font-size:1.1em;flex-direction:column;padding:2em;opacity:0;pointer-events:none;transition:.5s;}
      #uitleg-overlay.show {opacity:1;pointer-events:auto;}
      #fallback-content {width:100%;}
      #fallback-tip {display:block;margin-top:1.2em;font-size:0.96em;color:#ddd;}
      @media (max-width:600px), (max-height:700px) {
        #overlay,#fallback,#loader,#ankerherkend {font-size:0.97em;padding:0.7em;}
        #insta-btn, #uitleg-btn, #lang-switch {font-size:0.93em;padding:7px 10px;border-radius:15px;}
      }
    </style>
  </head>
  <body>
    <div id="overlay">
      <span class="nl">Richt je camera op het ankerbeeld om het kunstwerk te zien</span>
      <span class="en" style="display:none;">Point your camera at the anchor image to see the artwork</span>
    </div>
    <div id="uitleg-overlay">
      <div>
        <b class="nl">Uitleg</b><b class="en" style="display:none;">Instructions</b><br><br>
        <span class="nl">Dit is een voorbeeldtekst. Hier kun je uitleg geven over het kunstwerk, de werking van AR, of iets anders.</span>
        <span class="en" style="display:none;">This is a sample text. Here you can explain the artwork, how AR works, or anything else.</span>
        <br><br>
        <button onclick="document.getElementById('uitleg-overlay').classList.remove('show');" style="margin-top:1em;" class="nl">Sluiten</button>
        <button onclick="document.getElementById('uitleg-overlay').classList.remove('show');" style="margin-top:1em;display:none;" class="en">Close</button>
      </div>
    </div>
    <div id="fallback" class="hide">
      <div id="fallback-content">
        <span class="nl">Geen anker gevonden.<br>Richt je camera op het herkenningsbeeld of verplaats je iets dichterbij.</span>
        <span class="en" style="display:none;">No anchor found.<br>Point your camera at the anchor image or move closer.</span>
        <small id="fallback-tip"></small>
      </div>
    </div>
    <div id="loader">Laden...</div>
    <div id="ankerherkend" class="hide"><span class="nl">Anker herkend!</span><span class="en" style="display:none;">Anchor found!</span></div>
    <button id="lang-switch">EN</button>
    <button id="uitleg-btn" class="nl">Uitleg</button>
    <button id="uitleg-btn-en" class="en" style="display:none;">Instructions</button>
    <a href="https://instagram.com/ralf_gloudemans" target="_blank" id="insta-btn">@ralf_gloudemans</a>
    <a-scene
      mindar-image="imageTargetSrc: ./targets.mind;"
      color-space="sRGB"
      renderer="colorManagement: true, physicallyCorrectLights"
      vr-mode-ui="enabled: false"
      device-orientation-permission-ui="enabled: true"
      xr-mode-ui="enabled: false"
      embedded
    >
      <a-assets>
        <a-asset-item id="lamp" src="./hanglamp+groot.glb"></a-asset-item>
      </a-assets>
      <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>
      <a-entity mindar-image-target="targetIndex: 0" id="target-entity">
        <a-entity gltf-model="#lamp" scale="1 1 1" rotation="0 0 0" position="0 0 0" visible="true" id="artmodel"></a-entity>
        <a-plane width="0.8" height="0.8" color="#000" opacity="0.18" rotation="-90 0 0" position="0 0 0"></a-plane>
      </a-entity>
    </a-scene>
    <script>
      // Meertalige switch: toon alle .nl of .en tegelijk
      document.getElementById('lang-switch').onclick = function() {
        let isNL = document.querySelector('.nl:not([style*="display: none"])');
        let toShow = isNL ? 'en' : 'nl';
        let toHide = isNL ? 'nl' : 'en';
        document.querySelectorAll('.'+toShow).forEach(el=>el.style.display='');
        document.querySelectorAll('.'+toHide).forEach(el=>el.style.display='none');
        document.getElementById('lang-switch').textContent = isNL ? 'NL' : 'EN';
      };

      // Uitleg overlay
      document.getElementById('uitleg-btn').onclick = function() {
        document.getElementById('uitleg-overlay').classList.add('show');
      };
      document.getElementById('uitleg-btn-en').onclick = function() {
        document.getElementById('uitleg-overlay').classList.add('show');
      };

      // Loader/fallback/anker feedback
      const overlay = document.getElementById('overlay');
      const fallback = document.getElementById('fallback');
      const fallbackTip = document.getElementById('fallback-tip');
      const loader = document.getElementById('loader');
      const ankerherkend = document.getElementById('ankerherkend');
      const targetEntity = document.querySelector('#target-entity');
      let tracking = false, fallbackTimeout = null, tipShown = false;

      // Hide loader na 5s of als model geladen is
      let loaderShown = true;
      function hideLoader() {
        if (loaderShown) {
          loader.classList.add('hide');
          loaderShown = false;
        }
      }
      document.getElementById('artmodel').addEventListener('model-loaded', hideLoader);
      setTimeout(hideLoader, 5000);

      // Overlay verdwijnt bij anker, fallback na 8s
      document.querySelector('a-scene').addEventListener('targetFound', () => {
        overlay.classList.add('hide');
        fallback.classList.add('hide');
        fallbackTip.textContent = "";
        tipShown = false;
        tracking = true;
        if (fallbackTimeout) clearTimeout(fallbackTimeout);
        ankerherkend.classList.remove('hide');
        setTimeout(()=>{ ankerherkend.classList.add('hide'); }, 1800);
      });
      document.querySelector('a-scene').addEventListener('targetLost', () => {
        tracking = false;
        fallbackTimeout = setTimeout(() => {
          if (!tracking) fallback.classList.remove('hide');
        }, 8000);
      });
      setTimeout(() => {
        if (!tracking) fallback.classList.remove('hide');
      }, 8000);

      // Performance cue: na 15s nog geen tracking? Toon extra tip (onder tekst)
      setTimeout(()=>{
        if (!tracking && !tipShown) {
          fallbackTip.textContent = document.querySelector('.nl:not([style*="display: none"])') ?
            "Tip: Houd je camera stil en richt goed op het ankerbeeld." :
            "Tip: Keep your camera steady and point at the anchor image.";
          tipShown = true;
        }
      }, 15000);
    </script>
  </body>
</html>
